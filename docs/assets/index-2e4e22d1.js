(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();const b=(t,e,n)=>{var c;const r=(c=t.at(-1))==null?void 0:c.isDealer,s={...n,isDealer:e,name:"",cards:[],score:0};if(e&&r)throw new Error("Ya hay un dealer");r?t.splice(-1,0,s):t.push(s)},C=(t,e)=>{const n=[];return t.forEach(r=>{e.forEach(s=>{n.push(`${s}${r}`)})}),n.sort(()=>Math.random()-.5)},R=t=>t.map(()=>{const e=document.createElement("img");return e.src="./assets/cards/red_back.png",e.classList.add("card"),e}),D=(t,e,n,r)=>{const s=document.createElement("div"),c=document.createElement("input"),o=document.createElement("button");return s.classList.add("player-input","mb-1"),c.type="text",c.placeholder=`Nombre del jugador - ${e}`,o.classList.add("btn-danger"),o.innerText="-",n&&c.addEventListener("input",d=>n(t,d.target.value)),r&&o.addEventListener("click",()=>r(t)),s.append(c,o),{divInput:s}},w=(t,e,n)=>{const r=document.createElement("div"),s=document.createElement("h4"),c=document.createElement("div"),o=document.createElement("button"),d=document.createElement("button"),u=document.createElement("div");return r.classList.add("player","box"),s.classList.add("head","mb-1"),c.classList.add("actions","mb-2"),o.classList.add("btn-secondary"),o.innerText="Pedir carta",d.classList.add("btn-info"),d.innerText="Detenerme",u.classList.add("body"),e&&o.addEventListener("click",()=>e(t)),n&&d.addEventListener("click",()=>n(t)),r.append(s,c,u),c.append(o,d),{divSpace:r,h4Player:s,divCards:u}},N=(t,e)=>{const n=t.at(-1).score;for(let r=0;r<t.length-1;r++)t[r].divSpaceRef.classList.add(t[r].score>n&&t[r].score<=21?"winner":"loser");setTimeout(()=>{e()},5e3)},q=t=>{const e=t.divCardsRef.querySelectorAll("img");t.cards.forEach((n,r)=>{if(e[r])return;const s=document.createElement("img");s.classList.add("card"),s.src=t.isDealer&&!r?"./assets/cards/red_back.png":`./assets/cards/${n}.png`,t.divCardsRef.append(s)})},x=t=>{if(!t.length)return;const[e]=t.splice(-1,1);return e},T=t=>{const e=t.slice(0,-1);return isNaN(e)?e==="A"?[11,1]:[10]:[Number(e)]},S=t=>{let e=0,n=0;return t.forEach(r=>{const[s,c]=T(r);e+=s,n+=c||s}),n<=e&&e<=21?e:n},k=t=>{t.forEach(e=>{var n;!e.isDealer&&e.divSpaceRef.classList.remove("current"),e.cards=[],e.score=0,(n=e.divSpaceRef)==null||n.classList.remove("current","winner","loser"),e.divCardsRef.innerHTML=""})},I=document.querySelector("#btnNewGame"),M=document.querySelector("#btnConfPlayers"),g=document.querySelector("#deck"),A=document.querySelector("#dealerSpace"),O=document.querySelector("#players"),$=document.querySelector("#players-modal"),G=document.querySelector("#players-inputs"),H=document.querySelector("#btnAddPlayer"),_=document.querySelector("#btnCloseModal"),K=new Array(9).fill().map((t,e)=>e+2),j=["S","H","C","D"],B=["A",...K,"J","Q","K"];let l=[],m=[],a=[],i=-1,f=!1;const p=()=>{$.classList.toggle("show")},F=()=>{p(),a.length&&f&&P()},J=()=>{const t=new Date().getTime(),{divInput:e}=D(t,a.length+1,E,Q),{divSpace:n,h4Player:r,divCards:s}=w(t,V,W);b(a,!1,{inputRef:e,divSpaceRef:n,h4PlayerRef:r,divCardsRef:s,id:t}),G.append(e),O.append(n)},E=(t,e)=>{const n=a.find(r=>r.id===t);n.h4PlayerRef.innerText=e,n.name=e},Q=t=>{const e=a.findIndex(n=>n.id===t);a[e].inputRef.remove(),a[e].divSpaceRef.remove(),a.splice(e,1)},h=()=>{if(a.at(-1).isDealer)return;const t=new Date().getTime(),e=document.createElement("h4"),n=document.createElement("div");e.classList.add("head"),n.classList.add("body"),b(a,!0,{inputRef:null,divSpaceRef:null,h4PlayerRef:e,divCardsRef:n,id:t}),A.append(e,n),E(t,"Dealer")},V=t=>{const e=a.find(n=>n.id===t);v(e),e.score>=21&&y()},W=()=>{y()},v=t=>{const e=x(l);t.cards.push(e),t.score=S(t.cards),Y(),q(t)},Y=()=>{const[t]=m.splice(-1,1);t.remove()},z=async()=>{const t=a.length*2;for(let e=0;e<t;e++){await new Promise(r=>setTimeout(()=>r(),500));const n=a[e]||a[e-a.length];v(n)}},U=t=>{const e=t.divCardsRef.querySelector("img");e.src=`./assets/cards/${t.cards[0]}.png`},X=()=>{const t=a.at(-1);U(t);do{const e=l.at(-1);if(S([...t.cards,e])>21)break;v(t)}while(t.score>=21);N(a,L)},y=()=>{var t,e,n,r;(e=(t=a[i])==null?void 0:t.divSpaceRef)==null||e.classList.remove("current"),i++,(r=(n=a[i])==null?void 0:n.divSpaceRef)==null||r.classList.add("current"),a[i].isDealer&&X()},L=async()=>{i=-1,k(a),await z(),y()},P=async()=>{if(f=!a.length,f)return p();a.at(-1).isDealer||h(),l=C(j,B),m=R(l),g.innerHTML="",g.append(...m),h(),L()};I.addEventListener("click",P);M.addEventListener("click",p);_.addEventListener("click",F);H.addEventListener("click",J);
